# Ralph Progress Log

## Codebase Patterns
- Icons in `packages/ui/src/icons/` use simple interface with `className?: string` prop
- Icons use `stroke="currentColor"` and `strokeWidth="2"` for consistent styling
- All icons use 24x24 viewBox
- Icons must be exported from `packages/ui/src/icons/index.ts`

---

## Iterations

### Iteration: 2026-01-14
**Story:** US-001 - Create NotificationIcon component
**Status:** Complete

**What was done:**
- Created `packages/ui/src/icons/NotificationIcon.tsx` with bell icon SVG
- Followed same props pattern as BagIcon (className prop)
- Exported from `packages/ui/src/icons/index.ts`

**Files changed:**
- `packages/ui/src/icons/NotificationIcon.tsx` (new)
- `packages/ui/src/icons/index.ts` (modified)

**Learnings for future iterations:**
- Icon components follow a simple pattern: interface with className, return SVG with viewBox 0 0 24 24
- Use stroke-based paths with strokeWidth="2" and strokeLinecap="round" for consistency
- Typecheck runs quickly (~3s) and validates all packages

### Iteration: 2026-01-14
**Story:** US-002 - Create notifications MDX content file
**Status:** Complete

**What was done:**
- Created `apps/website/app/content/notifications.mdx` with exported notifications array
- Added 3 example notifications (1 product, 2 blog)
- Each notification has: id, type, title, description, href, date

**Files changed:**
- `apps/website/app/content/notifications.mdx` (new)

**Learnings for future iterations:**
- MDX files can export JavaScript values using `export const` syntax
- This allows MDX to be used for both rendered content and data exports
- The blog content pattern uses a separate `index.ts` file, but for simple data exports MDX works directly
- Notification structure matches what API route will need: id, type, title, description, href, date

### Iteration: 2026-01-14
**Story:** US-003 - Create API route for notifications
**Status:** Complete

**What was done:**
- Created `apps/website/app/routes/api.notifications.tsx` returning JSON from content file
- Converted notifications from MDX to TypeScript (`notifications.ts`) for proper typing
- Added `Notification` interface with proper type definitions

**Files changed:**
- `apps/website/app/routes/api.notifications.tsx` (new)
- `apps/website/app/content/notifications.ts` (new - replaces notifications.mdx)
- `apps/website/app/content/notifications.mdx` (deleted)

**Learnings for future iterations:**
- MDX named exports don't work with TypeScript module declarations - use `.ts` files for typed data
- API routes follow pattern: return `new Response(JSON.stringify(data), {status, headers})`
- Follow existing API route patterns in `apps/website/app/routes/api.*.tsx`
- The blog content pattern uses TypeScript index.ts for data - notifications should follow same pattern

### Iteration: 2026-01-14
**Story:** US-004 - Create useNotifications hook with localStorage
**Status:** Complete

**What was done:**
- Created `apps/website/app/hooks/useNotifications.ts` hook
- Fetches notifications from `/api/notifications` using `useFetcher`
- Tracks read notification IDs in localStorage (key: `wakey-read-notifications`)
- Exposes: `notifications`, `unreadCount`, `hasUnread`, `markAsRead`, `markAllAsRead`, `isLoading`
- SSR-safe: handles server/client rendering and hydration

**Files changed:**
- `apps/website/app/hooks/useNotifications.ts` (new)

**Learnings for future iterations:**
- Use `useFetcher` from `react-router` for data fetching in hooks (not `useLazyFetch` from packages/hooks for website-specific hooks)
- Check for `typeof window === 'undefined'` for SSR safety with localStorage
- Type assertions (`as string[]`) are needed after `JSON.parse()` for TypeScript
- useState with function initializer `() => getReadIds()` for lazy initialization
- Sync state from localStorage on mount with useEffect for SSR hydration

### Iteration: 2026-01-14
**Story:** US-005 - Create NotificationDropdown component (also completes US-008)
**Status:** Complete

**What was done:**
- Created `apps/website/app/components/NotificationDropdown.tsx`
- Used CSS grid animation pattern from NavigationDropdown (grid-template-rows transition)
- Added type indicator badges: "New Product" (softorange/20) and "New Post" (skyblue/20)
- Added unread indicator dot (bg-softorange) for unread notifications
- Read notifications dimmed with opacity-60
- Each notification links to href and calls onMarkAsRead + onClose on click
- Component receives notifications, readIds (Set), and callbacks as props

**Files changed:**
- `apps/website/app/components/NotificationDropdown.tsx` (new)

**Learnings for future iterations:**
- NavigationDropdown pattern: outer div with `grid transition-[grid-template-rows]`, inner with `overflow-hidden`
- Use `gridTemplateRows: isOpen ? '1fr' : '0fr'` for smooth height animation
- `var(--ease-out-expo)` for timing function consistency with nav dropdown
- Component takes readIds as Set<string> for O(1) lookup of read state
- US-008 (type indicators/styling) was naturally implemented as part of the dropdown component

### Iteration: 2026-01-14
**Story:** US-006 - Add notification icon with badge to Header
**Status:** Complete

**What was done:**
- Added NotificationIcon import from @wakey/ui to Header component
- Imported NotificationDropdown and useNotifications hook
- Created NotificationButton component with:
  - Bell icon using NotificationIcon
  - Orange dot badge (bg-softorange) when hasUnread is true
  - ARIA attributes for accessibility (aria-label, aria-controls, aria-expanded)
- Added notification state management (isNotificationsOpen)
- Implemented mutual exclusion: opening one dropdown closes the other
- Updated click-outside handler to close both dropdowns
- Extended useNotifications hook to export readIds for NotificationDropdown

**Files changed:**
- `apps/website/app/components/Header.tsx` (modified)
- `apps/website/app/hooks/useNotifications.ts` (modified - added readIds to return)

**Learnings for future iterations:**
- Button component pattern: use same styling as HeaderButton but with relative positioning for badge
- Badge positioning: `absolute top-1 right-1 md:top-2.5 md:right-2.5` for proper placement
- Mutual exclusion pattern: in toggle handler, check `if (next) setOtherState(false)`
- Use `isAnyDropdownOpen` computed value for shared side effects (scroll lock, click-outside)
- The dropdown should be placed in the same container as NavigationDropdown for consistent positioning

