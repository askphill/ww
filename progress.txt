# Ralph Progress Log

## Codebase Patterns
<!-- Ralph will add discovered patterns here -->

---

## Iterations

### Iteration: 2026-01-13
**Story:** US-001 - Create AnnouncementBar component
**Status:** Complete

**What was done:**
- Created AnnouncementBar.tsx component matching header styling patterns
- Used same padding (px-4 mobile, md:px-6 desktop), max-width (600px), and rounded-card
- Applied bg-ocher background with text-black font-display text-small styling
- Component accepts a `message` prop for customizable announcement text
- Verified build passes (typecheck has pre-existing errors unrelated to this component)

**Files changed:**
- apps/website/app/components/AnnouncementBar.tsx (created)

**Learnings for future iterations:**
- Header uses `pointer-events-none` on wrapper and `pointer-events-auto` on inner content for floating behavior
- Theme has `@keyframes marquee` and `animate-marquee` utility already defined for US-002
- Pre-existing typecheck errors exist in packages/ui and packages/hooks (React types) - build still works

### Iteration: 2026-01-13 (continued)
**Story:** US-002 - Add marquee animation to AnnouncementBar
**Status:** Complete

**What was done:**
- Added continuous scrolling animation using existing `animate-marquee` utility
- Duplicated message text to create seamless looping effect
- Applied `overflow-hidden` to container to clip the scrolling content
- Changed from `text-center` to `flex whitespace-nowrap` for proper marquee layout
- Each message has `px-8` spacing for visual separation in the loop

**Files changed:**
- apps/website/app/components/AnnouncementBar.tsx (modified)

**Learnings for future iterations:**
- Marquee animation works by translating -50% so duplicating content creates seamless loop
- `whitespace-nowrap` is essential to prevent text wrapping in marquee
- Build passes but typecheck has pre-existing errors (unrelated to this work)

### Iteration: 2026-01-13 (continued)
**Story:** US-003 - Create NavigationDropdown component structure
**Status:** Complete

**What was done:**
- Created NavigationDropdown.tsx component with Shop and Learn sections
- Shop section links: Wakey Deodorant → /products/deodorant, Natural Deodorant → /products/natural-deodorant
- Learn section links: About us → /about, FAQ → /faq, Blog → /blog
- Section labels use text-body-small font-display uppercase tracking-wide text-black/60
- Nav links use text-h3 font-display with hover state (text-black/70)
- Background is bg-sand with rounded-card border radius
- Same padding as header (px-4 mobile, md:px-6 desktop)
- Component accepts isOpen (visibility) and onClose (callback for nav link clicks) props

**Files changed:**
- apps/website/app/components/NavigationDropdown.tsx (created)

**Learnings for future iterations:**
- Navigation data stored as NAV_SECTIONS constant for easy maintenance
- Component returns null when !isOpen for simple visibility control
- onClose callback allows parent component to control state on navigation
- Website build passes independently even when turbo build fails on other apps

### Iteration: 2026-01-13 (continued)
**Story:** US-004 - Position NavigationDropdown below header
**Status:** Complete

**What was done:**
- Integrated NavigationDropdown into Header component (same container/wrapper)
- Changed header layout from `flex justify-center` to `flex flex-col items-center` for vertical stacking
- Added `mt-2` gap between header pill and dropdown via wrapper div
- Added `isMenuOpen` and `onMenuClose` props to Header for external state control
- NavigationDropdown inherits z-50 from header, will overlay announcement bar when open

**Files changed:**
- apps/website/app/components/Header.tsx (modified)

**Learnings for future iterations:**
- Header uses flex-col to stack header pill and dropdown vertically
- Both components get `pointer-events-auto` for click handling on fixed header
- NavigationDropdown already has correct max-width (600px) and centering internally
- State props (isMenuOpen, onMenuClose) prepared for US-006 toggle implementation

### Iteration: 2026-01-13 (continued)
**Story:** US-005 - Add slide-down animation to NavigationDropdown
**Status:** Complete

**What was done:**
- Replaced conditional rendering with CSS grid height animation for smooth push effect
- Grid wrapper uses `grid-template-rows` transitioning between `0fr` (closed) and `1fr` (open)
- Added `overflow-hidden` wrapper to clip content during height animation
- Inner nav has `opacity-0 -translate-y-4` → `opacity-100 translate-y-0` for visual slide effect
- Uses `--ease-out-expo` timing function from theme (300ms duration)
- Added `aria-hidden` and `tabIndex` management for accessibility
- Component always renders (no `return null`) to enable smooth CSS transitions

**Files changed:**
- apps/website/app/components/NavigationDropdown.tsx (modified)

**Learnings for future iterations:**
- CSS grid `grid-template-rows: 0fr/1fr` transition is best for smooth height animations (push effect)
- Must keep element in DOM (no conditional render) for CSS transitions to work
- `overflow-hidden` wrapper essential to clip content when collapsed
- Combine height animation (grid) with opacity/translate animation for polished feel
- Build passes independently with `cd apps/website && pnpm build`

### Iteration: 2026-01-13 (continued)
**Story:** US-006 - Implement menu toggle behavior
**Status:** Complete

**What was done:**
- Added `useState` hook to Header for internal menu state management
- Replaced `useAside().open('mobile')` with internal toggle logic
- MenuToggleButton now receives `isOpen` and `onToggle` props
- Dynamic `aria-label` switches between "Open menu" and "Close menu"
- Added `aria-expanded` attribute that reflects actual menu state
- Added `id="navigation-dropdown"` to NavigationDropdown for `aria-controls` reference
- Removed unused `useAside` import from Header

**Files changed:**
- apps/website/app/components/Header.tsx (modified)
- apps/website/app/components/NavigationDropdown.tsx (modified)

**Learnings for future iterations:**
- Header now manages menu state internally via useState (simplified from external prop pattern)
- Old MobileMenuAside drawer still exists in PageLayout (to be removed in US-010)
- Toggle pattern: `setIsMenuOpen((prev) => !prev)` for reliable state flip
- aria-controls should reference element id for accessibility compliance

### Iteration: 2026-01-13 (continued)
**Story:** US-007 - Implement click-outside-to-close behavior
**Status:** Complete

**What was done:**
- Added useEffect with document mousedown listener to detect clicks outside header
- Created headerRef to track the header element for contains() check
- Menu closes when clicking outside header area (including dropdown)
- Menu stays open when clicking inside header or dropdown
- Nav link clicks already handled by onClose callback (from US-003)
- Effect cleanup removes listener when menu closes or component unmounts

**Files changed:**
- apps/website/app/components/Header.tsx (modified)

**Learnings for future iterations:**
- Use mousedown instead of click for immediate response (before click completes)
- useEffect with dependency on isMenuOpen ensures listener only active when needed
- headerRef.current.contains(event.target) checks if click is inside header DOM tree
- MCP chrome-devtools click may not trigger mousedown - use evaluate_script for testing

### Iteration: 2026-01-13 (continued)
**Story:** US-008 - Integrate AnnouncementBar into PageLayout
**Status:** Complete

**What was done:**
- Imported AnnouncementBar component into PageLayout.tsx
- Added fixed positioned wrapper below header (top-[76px] mobile, top-[84px] desktop)
- Set z-40 z-index so navigation dropdown (z-50) overlays it when open
- Applied pointer-events-none/auto pattern for proper click handling
- Used "Free shipping on orders over €50" as example text

**Files changed:**
- apps/website/app/components/PageLayout.tsx (modified)

**Learnings for future iterations:**
- Header is ~56px height + 16px padding = 72px, add small gap → top-[76px] for mobile
- Desktop header has md:pt-6 (24px) padding + similar height → top-[84px]
- Use z-40 for elements that should appear below header dropdown (z-50)
- Fixed elements need pointer-events-none/auto pattern to not block clicks

### Iteration: 2026-01-13 (continued)
**Story:** US-009 - Handle body scroll when menu is open
**Status:** Complete

**What was done:**
- Added useEffect to Header that manages body scroll lock
- When menu opens, adds `overflow-hidden` class to document.body
- When menu closes, removes `overflow-hidden` class from document.body
- Cleanup function ensures scroll is always restored on unmount
- Works correctly with toggle, click-outside, and navigation closes

**Files changed:**
- apps/website/app/components/Header.tsx (modified)

**Learnings for future iterations:**
- Simple classList.add/remove is sufficient for body scroll lock
- Effect cleanup is critical to prevent scroll staying locked after unmount
- Both the open→close state change AND the cleanup handle scroll restoration

### Iteration: 2026-01-13 (continued)
**Story:** US-010 - Remove old Aside mobile menu component
**Status:** Complete

**What was done:**
- Removed MobileMenuAside function from PageLayout.tsx
- Removed unused imports (NavLink, useAside, CrossIcon) and menu constants (PRIMARY_MENU, SECONDARY_MENU, SOCIAL_LINKS)
- Removed 'mobile' type from AsideType union in Aside.tsx
- Simplified Aside drawer logic - now only supports right-side sliding (cart/search)
- Updated component comment to reflect simplified functionality
- Aside.Provider is retained as it's still used for cart functionality (ProductForm.tsx opens cart)

**Files changed:**
- apps/website/app/components/PageLayout.tsx (modified - removed ~90 lines)
- apps/website/app/components/Aside.tsx (modified - simplified)

**Learnings for future iterations:**
- Aside.Provider and useAside are still used by cart/search components even without visible drawer
- ProductForm.tsx calls `open('cart')` but no cart drawer exists yet (future feature)
- Build passes independently even with pre-existing typecheck errors in packages/ui and packages/hooks
- 107 lines removed total - significant cleanup

