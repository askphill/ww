# Ralph Progress Log

## Codebase Patterns
<!-- Ralph will add discovered patterns here -->

---

## Iterations

### Iteration: 2026-01-14
**Story:** US-001 - Add AI assistant icon to @wakey/ui
**Status:** Complete

**What was done:**
- Created SparkleIcon component in `packages/ui/src/icons/SparkleIcon.tsx`
- Icon features a main 4-point star with two smaller accent sparkles
- Follows existing icon patterns: uses `currentColor` for fill, accepts `className` prop
- Exported from `packages/ui/src/icons/index.ts`

**Files changed:**
- packages/ui/src/icons/SparkleIcon.tsx (created)
- packages/ui/src/icons/index.ts (updated export)

**Learnings for future iterations:**
- Icon pattern uses interface props with `className?: string`
- Icons use `currentColor` for fill/stroke to inherit text color
- New icons should have a unique viewBox matching their design

### Iteration: 2026-01-14
**Story:** US-002 - Add AI assistant button to header
**Status:** Complete

**What was done:**
- Added `SparkleIcon` import to Header.tsx from @wakey/ui
- Added optional `onAssistantToggle` prop to HeaderProps interface
- Created `AssistantButton` component following existing `HeaderButton` pattern
- Button placed between menu toggle and logo in header left side
- Button only renders when `onAssistantToggle` prop is provided (allows conditional display)
- Verified button appears correctly and triggers callback on click via chrome-devtools MCP

**Files changed:**
- apps/website/app/components/Header.tsx (updated)

**Learnings for future iterations:**
- Header uses `HeaderButton` component for consistent button styling (w-8 h-8 md:w-12 md:h-12, hover-scale)
- Header uses grid layout: `grid-cols-[1fr_auto_1fr]` for left/center/right sections
- Optional props allow conditional rendering - good pattern for features being wired up later
- PageLayout.tsx is where Header is instantiated with props from root

### Iteration: 2026-01-14
**Story:** US-003 - Create full-screen overlay container
**Status:** Complete

**What was done:**
- Created `AssistantOverlay` component in `apps/website/app/components/assistant/AssistantOverlay.tsx`
- Component uses `fixed inset-0 z-40` positioning (below header z-50)
- Added animated gradient background with brand colors using CSS keyframes
- Gradient animation runs 25s loop with smooth position shifts
- Created index.ts barrel export for assistant components
- Verified overlay displays correctly and header remains functional via chrome-devtools MCP

**Files changed:**
- apps/website/app/components/assistant/AssistantOverlay.tsx (created)
- apps/website/app/components/assistant/index.ts (created)
- apps/website/app/styles/tailwind.css (added gradient animation)

**Learnings for future iterations:**
- z-index hierarchy: Header z-50, Aside backdrop z-60, Aside drawer z-70 - overlay uses z-40 to stay below header
- Custom CSS classes for animations can be added to tailwind.css (not theme.css) for app-specific styles
- Component uses `aria-hidden` for accessibility when overlay is closed
- Future stories (US-025) will wire up the overlay in PageLayout with proper state management

### Iteration: 2026-01-14
**Story:** US-004 - Add overlay open/close state management
**Status:** Complete

**What was done:**
- Added `onClose` prop to AssistantOverlay component
- Added close button (CrossIcon from @wakey/ui) in top-right corner of overlay
- Implemented body scroll lock using `document.body.style.overflow = 'hidden'`
- Added Escape key handler using event listener with AbortController
- Updated transition to 400ms with fade + scale effect using `--ease-out-expo`
- Added accessibility attributes: `role="dialog"`, `aria-modal={isOpen}`
- Wired up overlay in PageLayout.tsx with useState for testing

**Files changed:**
- apps/website/app/components/assistant/AssistantOverlay.tsx (updated)
- apps/website/app/components/PageLayout.tsx (updated)

**Learnings for future iterations:**
- Follow Aside.tsx pattern for body scroll lock and Escape key handling
- Use AbortController for clean event listener cleanup
- `--ease-out-expo` CSS variable is available for smooth easing
- Close button positioned at `top-4 right-4 md:top-6 md:right-6` matches responsive design
- PageLayout now has overlay wired up - US-025 will just need to clean up the test content

### Iteration: 2026-01-14
**Story:** US-005 - Create conversation state machine hook
**Status:** Complete

**What was done:**
- Created `useAssistantFlow` hook in `apps/website/app/hooks/useAssistantFlow.ts`
- Defined `StepId` type for all 7 conversation steps
- Defined `AnswerValue` type supporting string, string array (multi-select), and Record (forms)
- Implemented state: `currentStepId`, `answers` (typed Record), `history` (step array)
- Implemented actions: `next(answer?)`, `back()`, `reset()`
- Added computed properties: `isFirstStep`, `isLastStep`
- Used STEP_ORDER array for linear progression through steps

**Files changed:**
- apps/website/app/hooks/useAssistantFlow.ts (created)

**Learnings for future iterations:**
- State machine pattern: use STEP_ORDER array to define flow sequence
- History array enables back navigation by popping last entry
- next(answer?) optionally stores answer before advancing
- Type-safe answers using `Partial<Record<StepId, AnswerValue>>`
- Import types from this hook when building step components (US-006, US-007, etc.)

### Iteration: 2026-01-14
**Story:** US-006 - Create conversation step definitions
**Status:** Complete

**What was done:**
- Created `assistantSteps.ts` in `apps/website/app/lib/assistantSteps.ts`
- Defined `StepType` union: 'text' | 'choice' | 'multi-choice' | 'input' | 'recommendation' | 'summary'
- Created `StepOption` interface for choice/multi-choice options with value, label, description
- Created `StepInputField` interface for input step fields with name, type, label, placeholder, required
- Defined variant step interfaces: `TextStep`, `ChoiceStep`, `MultiChoiceStep`, `InputStep`, `RecommendationStep`, `SummaryStep`
- Created `Step` union type combining all step variants
- Populated `ASSISTANT_STEPS` array with all 7 step configurations
- Added helper functions: `getStepById(stepId)`, `getStepIndex(stepId)`, `TOTAL_STEPS`

**Files changed:**
- apps/website/app/lib/assistantSteps.ts (created)

**Learnings for future iterations:**
- Use discriminated union pattern with `type` field to create type-safe step variants
- Step definitions are data-driven - easy to add/modify steps without changing component logic
- Import `StepId` from useAssistantFlow.ts to ensure step IDs stay in sync
- Import step types (Step, ChoiceStep, etc.) when building step renderer components
- Helper functions like `getStepById` will be useful for step rendering components

